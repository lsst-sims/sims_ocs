

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Usage &mdash; Simulated OCS 1.0.10 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Simulated OCS 1.0.10 documentation" href="index.html"/>
        <link rel="next" title="Survey Database" href="database.html"/>
        <link rel="prev" title="Installation" href="installation.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Simulated OCS
          

          
            
            <img src="_static/socs_logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.0.10
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#running-opsim">Running OpSim</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#saving-configuration">Saving Configuration</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Survey Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/lsst.sims.ocs.html">lsst.sims.ocs package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Simulated OCS</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Usage</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<p>We start this section by assuming you have followed the installation instructions and are within the created Conda environment. To setup the environment for running the Operations Simulator, do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">stack_install_dir</span><span class="o">/</span><span class="n">loadLSST</span><span class="o">.&lt;</span><span class="n">shell</span><span class="o">&gt;</span>
<span class="n">source</span> <span class="n">activate</span> <span class="n">opsim4</span>
<span class="n">setup</span> <span class="n">ts_scheduler</span>
<span class="n">setup</span> <span class="n">sims_ocs</span>
</pre></div>
</div>
<p>The Operations Simulator consists of running the SOCS and Scheduler along with a central logging process. Due to the nature of the setup, a wrapper script is recommended when launching the driver script. Two scripts have been provided in the <code class="docutils literal"><span class="pre">opsim4_tools</span></code> LSST Simulations organization GitHub repository. Both scripts need to be edited to provide locations for certain variables. See the comments within each script.</p>
<p>The <a class="reference external" href="https://raw.githubusercontent.com/lsst-sims/opsim4_tools/master/scripts/drun">first</a> script, called <code class="docutils literal"><span class="pre">drun</span></code>, is intended for use when running multiple simulations simultaneously. In order to keep the DDS messages from each simulation from potentially killing another running simulation, the <code class="docutils literal"><span class="pre">drun</span></code> script creates a dynamic, local DDS configuration file in the execution directory. The configuration file, called <code class="docutils literal"><span class="pre">.osplN.xml</span></code> where <code class="docutils literal"><span class="pre">N</span></code> is an integer, contains the dynamically allocated DDS domain Id which is represented by the <code class="docutils literal"><span class="pre">N</span></code>. One of these files will be generated for each invocation of <code class="docutils literal"><span class="pre">drun</span></code>. The <code class="docutils literal"><span class="pre">drun</span></code> script increments <code class="docutils literal"><span class="pre">N</span></code> on each invocation by looking at the <code class="docutils literal"><span class="pre">.osplN.xml</span></code> files already present in the execution directory. Under normal circumstances the dynamic configuration file is removed upon completion of <code class="docutils literal"><span class="pre">drun</span></code>. An exception to this is forceably killing a job via <code class="docutils literal"><span class="pre">ctrl+c</span></code> or <code class="docutils literal"><span class="pre">kill</span></code>. In this case, the dynamic configuration file cleanup does not occur and must be completed manually. If the cleanup does not occur, the operator runs the risk of making subsequent jobs access port numbers that are not specified in the firewall rules. Port range setup for multiple jobs was discussed in the <a class="reference internal" href="installation.html#installation-sal-installation"><span class="std std-ref">SAL installation</span></a> instructions and is tied to a given number of jobs for a machine. If the domain Id goes over the number of jobs minus 1, all DDS traffic is blocked for that simulation and message receiving loops will timeout causing the simulation to not work properly. The DDS configuration file that is associated with a given simulation can be found near the top of the corresponding log file and finding the <code class="docutils literal"><span class="pre">$OSPL_URI</span></code> entry. This is important to know if you want to attach a listener process, like a live viewer, to the running simulation or to clean up a killed job without effecting other running jobs.</p>
<p>The <a class="reference external" href="https://raw.githubusercontent.com/lsst-sims/opsim4_tools/master/scripts/drun_static">second</a> script, called <code class="docutils literal"><span class="pre">drun_static</span></code>, is intended for only running one simulation at any given time. This script points to a DDS configuration file that always has the same domain Id. <strong>HOWEVER</strong>, when using this script, the simulation run must be the only simulation running as the DDS domain Id will conflict with another running simulation. <code class="docutils literal"><span class="pre">drun_static</span></code> can be used to attach a listener process to the running simulation without any issues. The environment created via the <code class="docutils literal"><span class="pre">drun_static</span></code> wrapper is similar to the one inside a running Docker container. In this case, the container environment is preset upon entry, so there is  no need to use the <code class="docutils literal"><span class="pre">drun_static</span></code> wrapper. Also, a container is meant to run a single simulation, so the <code class="docutils literal"><span class="pre">drun</span></code> wrapper should be avoided. The messages from different containers are differentiated via the domain name which contains the container machine name.</p>
<div class="section" id="running-opsim">
<span id="running-opsim4"></span><h2>Running OpSim<a class="headerlink" href="#running-opsim" title="Permalink to this headline">¶</a></h2>
<p>The SOCS driver can be run from anywhere if the setup from the installation instructions were followed. We&#8217;ll assume that you are running from <code class="docutils literal"><span class="pre">$HOME/run_local</span></code>. In this directory, it is recommended to have <code class="docutils literal"><span class="pre">configs</span></code> and <code class="docutils literal"><span class="pre">log</span></code> sub-directories available. This will be helpful in containing all of the various outputs when running multiple simulations. To invoke a basic instance of SOCS, do the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">drun</span> <span class="n">opsim4</span> <span class="o">--</span><span class="n">frac</span><span class="o">-</span><span class="n">duration</span><span class="o">=</span><span class="mi">1</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;Running a one year sim.&quot;</span> <span class="o">-</span><span class="n">v</span>
</pre></div>
</div>
<p>This will run a one year simulation while passing messages between SOCS and the Scheduler via SAL/DDS. The SOCS driver script launches a central process for log messages coming from the SOCS and Scheduler drivers. It then launches the Scheduler driver.</p>
<p>Further options are available to the driver script and can be ascertained by the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">drun</span> <span class="n">opsim4</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<div class="section" id="saving-configuration">
<h3>Saving Configuration<a class="headerlink" href="#saving-configuration" title="Permalink to this headline">¶</a></h3>
<p>The full configuration used for a particular simulation can be saved after the execution of the simulation. This is accomplished by using <code class="docutils literal"><span class="pre">--save-config</span></code> flag:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">drun</span> <span class="n">opsim4</span> <span class="o">--</span><span class="n">frac</span><span class="o">-</span><span class="n">duration</span><span class="o">=</span><span class="mf">0.003</span> <span class="o">-</span><span class="n">c</span> <span class="s2">&quot;Testing config saving&quot;</span> <span class="o">--</span><span class="n">save</span><span class="o">-</span><span class="n">config</span>
</pre></div>
</div>
<p>This will cause the creation of a <code class="docutils literal"><span class="pre">config_&lt;session</span> <span class="pre">Id&gt;</span></code> directory. More concretely, if the session Id for the above execution was 2100, this will result in a directory called <code class="docutils literal"><span class="pre">config_2100</span></code> being created in the execution directory. Inside <code class="docutils literal"><span class="pre">config_2100</span></code> will be a Python file for each of the configuration classes contained within the SOCS code base. The values in those files will reflect any override values passed in at the beginning of the simulation.</p>
<p>If the configuration saving flag is used regularly, many directories could accumulate in the execution directory. Another directory can be used to organize the numerous <code class="docutils literal"><span class="pre">config_&lt;session</span> <span class="pre">Id&gt;</span></code> directories. This is accomplished by using the <code class="docutils literal"><span class="pre">--config-save-path</span></code> flag:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>drun opsim4 --frac-duration=0.003 -c &quot;Testing config saving&quot; --save-config --config-save-path=$PWD/configs
</pre></div>
</div>
<p>With this flag, the created <code class="docutils literal"><span class="pre">config_&lt;session</span> <span class="pre">Id&gt;</span></code> directory will be under <code class="docutils literal"><span class="pre">$PWD/configs</span></code>. If any part of the path does not exist, it will be created before the save is executed.</p>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="database.html" class="btn btn-neutral float-right" title="Survey Database" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="installation.html" class="btn btn-neutral" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2017, LSST Systems Engineering.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.10',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>