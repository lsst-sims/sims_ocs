

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Installation &mdash; Simulated OCS 1.0.11 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Simulated OCS 1.0.11 documentation" href="index.html"/>
        <link rel="next" title="Usage" href="usage.html"/>
        <link rel="prev" title="Simulated Observatory Control System" href="index.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Simulated OCS
          

          
            
            <img src="_static/socs_logo.png" class="logo" />
          
          </a>

          
            
            
              <div class="version">
                1.0.11
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#source-installation">Source Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#general-installation-notes">General Installation Notes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sal-installation">SAL Installation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#build-scheduler-topic-library">Build Scheduler Topic Library</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#scheduler-and-socs-source-code">Scheduler and SOCS Source Code</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#lsst-stack-installation">LSST Stack Installation</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#sky-brightness-model-data">Sky Brightness Model Data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#database-setup">Database Setup</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#docker-installation">Docker Installation</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="database.html">Survey Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">History</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/lsst.sims.ocs.html">lsst.sims.ocs package</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Simulated OCS</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Installation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/installation.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h1>
<p>Installation of the Operations Simulator can be done via a <a class="reference internal" href="#source-installation"><span class="std std-ref">source installation</span></a> for Linux systems and via <a class="reference internal" href="#docker-installation"><span class="std std-ref">Docker installation</span></a> for macOS systems. The Docker route is <strong>NOT</strong> recommended for Linux due to bind volume permission issues.</p>
<div class="section" id="source-installation">
<span id="id1"></span><h2>Source Installation<a class="headerlink" href="#source-installation" title="Permalink to this headline">¶</a></h2>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The current installation requires multiple repositories and a mixture of environments. It also only works on a Linux operating system. It has been tested only CentOS 7.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>If performing the installation on a virtual machine, it needs the following minimum requirements:</p>
<blockquote class="last">
<div><ul class="simple">
<li>Memory: 12 GB (minimum)</li>
<li>Number of processors: 3 (4 recommended)</li>
<li>Network: Bridged adapter</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="general-installation-notes">
<h3>General Installation Notes<a class="headerlink" href="#general-installation-notes" title="Permalink to this headline">¶</a></h3>
<p>Due to the heavy use of repositories for this installation, the instructions will assume you have created a directory in your <code class="docutils literal"><span class="pre">$HOME</span></code> directory to house all the git repositories. This will be referenced as <code class="docutils literal"><span class="pre">gitdir</span></code>. Nearly all instructions are based around using the code, not developing it. <strong>NOTE</strong>: Developers need to taken notice of GitHub repositories in the <code class="docutils literal"><span class="pre">lsst-ts</span></code> organization. These are mirror-only repositories and have corresponding counterparts in the LSST Stash ecosystem where the actual developement work takes place.</p>
</div>
<div class="section" id="sal-installation">
<span id="installation-sal-installation"></span><h3>SAL Installation<a class="headerlink" href="#sal-installation" title="Permalink to this headline">¶</a></h3>
<p>The SAL (Software Abstraction Layer) is a wrapper around the DDS (Data Distribution Service) layer and provides binding to Python. This requires the OpenSplice and SAL repositories from Telescope and Site. The <code class="docutils literal"><span class="pre">ts_xml</span></code> package contains all the XML files we will use to derive the DDS libraries from. Inside the <code class="docutils literal"><span class="pre">gitdir</span></code>, run the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lsst</span><span class="o">-</span><span class="n">ts</span><span class="o">/</span><span class="n">ts_opensplice</span><span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lsst</span><span class="o">-</span><span class="n">ts</span><span class="o">/</span><span class="n">ts_sal</span><span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lsst</span><span class="o">-</span><span class="n">ts</span><span class="o">/</span><span class="n">ts_xml</span>
</pre></div>
</div>
<p>In the SAL clone, there is a user guide that documents installation and setup of SAL. Its location is <code class="docutils literal"><span class="pre">gitdir/ts_sal/SAL_User_Guide.pdf</span></code>. Follow section 1 and the main part of section 2. Sub-sections (those colored blue) 2.1 and 2.2 are redundant as we’ve already installed the SAL. Sub-section 2.3 is replaced by the following documentation that is specific to this SOCS/Scheduler setup. <strong>NOTE</strong>: If you wish to support running more than one simulation at a time, the port range specified in the manual needs to be extended to accommodate this. The lowest port number is always 7400. To figure out the highest port number necessary, use this formula:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="mi">7413</span> <span class="o">+</span> <span class="p">(</span><span class="mi">14</span> <span class="o">*</span> <span class="p">(</span><span class="n">Njobs</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</pre></div>
</div>
<div class="section" id="build-scheduler-topic-library">
<h4>Build Scheduler Topic Library<a class="headerlink" href="#build-scheduler-topic-library" title="Permalink to this headline">¶</a></h4>
<p>Create a <code class="docutils literal"><span class="pre">$HOME/dds</span></code> directory and copy the <code class="docutils literal"><span class="pre">gitdir/ts_sal/setup.env</span></code> to it. Also, create a <code class="docutils literal"><span class="pre">$HOME/dds/lib</span></code> directory for later. The following variables need to be edited in <code class="docutils literal"><span class="pre">setup.env</span></code> to reflect your setup:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">LSST_SDK_INSTALL</span><span class="o">=</span><span class="n">gitdir</span><span class="o">/</span><span class="n">ts_sal</span>
<span class="n">export</span> <span class="n">OSPL_HOME</span><span class="o">=</span><span class="n">gitdir</span><span class="o">/</span><span class="n">ts_opensplice</span><span class="o">/</span><span class="n">OpenSpliceDDS</span><span class="o">/</span><span class="n">V6</span><span class="o">.</span><span class="mf">4.1</span><span class="o">/</span><span class="n">HDE</span><span class="o">/</span><span class="n">x86_64</span><span class="o">.</span><span class="n">linux</span>
</pre></div>
</div>
<p>All other variables can remain the same. Once the edits are complete, do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>source $HOME/dds/setup.env
</pre></div>
</div>
<p>The configuration should complete without errors. Copy the XML files from <code class="docutils literal"><span class="pre">gitdir/ts_xml/sal_interfaces</span></code> you wish your topic and supporting library to contain. For example if the only topics we wanted to use are scheduler telemetry ones we would do <code class="docutils literal"><span class="pre">cp</span> <span class="pre">$HOME/gitdir/ts_xml/sal_interfaces/scheduler/scheduler_Telemetry.xml</span> <span class="pre">$HOME/gitdir/ts_sal/test</span></code>. Go back to <code class="docutils literal"><span class="pre">gitdir/ts_sal</span></code> and do the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">test</span>
<span class="n">salgenerator</span> <span class="n">scheduler</span> <span class="n">validate</span>
<span class="n">salgenerator</span> <span class="n">scheduler</span> <span class="n">sal</span> <span class="n">cpp</span>
<span class="n">salgenerator</span> <span class="n">scheduler</span> <span class="n">sal</span> <span class="n">python</span>
</pre></div>
</div>
<p>Once the build is complete, the topic and supporting library need to be copied via the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>cp scheduler/cpp/src/SALPY_scheduler.so $HOME/dds/lib
cp scheduler/cpp/libsacpp_scheduler_types.so $HOME/dds/lib
</pre></div>
</div>
</div>
</div>
<div class="section" id="scheduler-and-socs-source-code">
<h3>Scheduler and SOCS Source Code<a class="headerlink" href="#scheduler-and-socs-source-code" title="Permalink to this headline">¶</a></h3>
<p>There are prerequisite repositories for the system that need to be downloaded. Go to <code class="docutils literal"><span class="pre">gitdir</span></code> and run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lsst</span><span class="o">/</span><span class="n">sims_skybrightness_pre</span><span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lsst</span><span class="o">-</span><span class="n">ts</span><span class="o">/</span><span class="n">ts_dateloc</span><span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lsst</span><span class="o">-</span><span class="n">ts</span><span class="o">/</span><span class="n">ts_astrosky_model</span><span class="o">.</span><span class="n">git</span>
<span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lsst</span><span class="o">-</span><span class="n">ts</span><span class="o">/</span><span class="n">ts_observatory_model</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>The Scheduler repository should also be cloned to <code class="docutils literal"><span class="pre">gitdir</span></code> via the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lsst</span><span class="o">-</span><span class="n">ts</span><span class="o">/</span><span class="n">ts_scheduler</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>The SOCS repository should also be cloned into the <code class="docutils literal"><span class="pre">gitdir</span></code> via the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">clone</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lsst</span><span class="o">-</span><span class="n">sims</span><span class="o">/</span><span class="n">sims_ocs</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<div class="section" id="lsst-stack-installation">
<h4>LSST Stack Installation<a class="headerlink" href="#lsst-stack-installation" title="Permalink to this headline">¶</a></h4>
<p>The SOCS and Scheduler installation require a set of packages from Python and the LSST Science Pipelines.
Follow the installation instructions from <a class="reference external" href="https://pipelines.lsst.io/install/newinstall.html">here</a> to get a minimal setup. In the <a class="reference external" href="https://pipelines.lsst.io/install/newinstall.html#installation-set-up">step</a> that gets the <code class="docutils literal"><span class="pre">newinstall.sh</span></code> script, replace the numeric version number with <code class="docutils literal"><span class="pre">master</span></code>. Go ahead and let the stack software provide Python unless you feel comfortable providing your own. Follow the instructions to get into the stack environment. The instructions will refer to the stack installation directory as <code class="docutils literal"><span class="pre">stack_install_dir</span></code>. It is recommended to use a conda environment especially if you are going to use the stack for other reasons. To create an environment, do the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="n">opsim4</span> <span class="o">--</span><span class="n">clone</span><span class="o">=</span><span class="n">root</span>
<span class="n">source</span> <span class="n">activate</span> <span class="n">opsim4</span>
<span class="n">conda</span> <span class="n">remove</span> <span class="n">conda</span><span class="o">-</span><span class="n">env</span>
</pre></div>
</div>
<p>The last line is necessary since the create complains about that package being duplicated. Next, install the following stack packages:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">eups</span> <span class="n">distrib</span> <span class="n">install</span> <span class="n">sims_utils</span> <span class="o">-</span><span class="n">t</span> <span class="n">sims</span>
<span class="n">eups</span> <span class="n">distrib</span> <span class="n">install</span> <span class="n">sims_survey_fields</span> <span class="o">-</span><span class="n">t</span> <span class="n">sims</span>
<span class="n">eups</span> <span class="n">distrib</span> <span class="n">install</span> <span class="n">pex_config</span> <span class="o">-</span><span class="n">t</span> <span class="n">sims</span>
</pre></div>
</div>
<p>Once this is complete, perform the following operations:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">update</span> <span class="n">sqlalchemy</span>
</pre></div>
</div>
<p>If one wishes to develop the code, being able to run the unit tests, check style compliance and generate the documentation is a must. To do this, these packages need to be installed:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">conda</span> <span class="n">install</span> <span class="n">mock</span> <span class="n">sphinx</span> <span class="n">sphinx_rtd_theme</span> <span class="n">flake8</span> <span class="n">coverage</span> <span class="n">pytest</span>
</pre></div>
</div>
<p>There is one package that is required for the documentation but is not available via the conda packaging system. To get this package, do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">rst</span>
</pre></div>
</div>
<p>With the environment setup, we need to declare and setup the prerequisite repos and then SOCS and Scheduler packages so they can be used.</p>
<p>Declare the pre-calculated sky brightness model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">gitdir</span><span class="o">/</span><span class="n">sims_skybrightness_pre</span>
<span class="n">eups</span> <span class="n">declare</span> <span class="n">sims_skybrightness_pre</span> <span class="n">git</span> <span class="o">-</span><span class="n">r</span> <span class="o">.</span> <span class="o">-</span><span class="n">c</span>
<span class="n">setup</span> <span class="n">sims_skybrightness_pre</span> <span class="n">git</span>
<span class="n">scons</span>
</pre></div>
</div>
<p>Declare the date and location package:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">gitdir</span><span class="o">/</span><span class="n">ts_dateloc</span>
<span class="n">eups</span> <span class="n">declare</span> <span class="n">ts_dateloc</span> <span class="n">git</span> <span class="o">-</span><span class="n">r</span> <span class="o">.</span> <span class="o">-</span><span class="n">c</span>
<span class="n">setup</span> <span class="n">ts_dateloc</span> <span class="n">git</span>
<span class="n">scons</span>
</pre></div>
</div>
<p>Declare the astronomical sky model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">gitdir</span><span class="o">/</span><span class="n">ts_astrosky_model</span>
<span class="n">eups</span> <span class="n">declare</span> <span class="n">ts_astrosky_model</span> <span class="n">git</span> <span class="o">-</span><span class="n">r</span> <span class="o">.</span> <span class="o">-</span><span class="n">c</span>
<span class="n">setup</span> <span class="n">ts_astrosky_model</span> <span class="n">git</span>
<span class="n">scons</span>
</pre></div>
</div>
<p>Declare the observatory model:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">gitdir</span><span class="o">/</span><span class="n">ts_observatory_model</span>
<span class="n">eups</span> <span class="n">declare</span> <span class="n">ts_observatory_model</span> <span class="n">git</span> <span class="o">-</span><span class="n">r</span> <span class="o">.</span> <span class="o">-</span><span class="n">c</span>
<span class="n">setup</span> <span class="n">ts_observatory_model</span> <span class="n">git</span>
<span class="n">scons</span>
</pre></div>
</div>
<p>Declare the Scheduler:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">gitdir</span><span class="o">/</span><span class="n">ts_scheduler</span>
<span class="n">eups</span> <span class="n">declare</span> <span class="n">ts_scheduler</span> <span class="n">git</span> <span class="o">-</span><span class="n">r</span> <span class="o">.</span> <span class="o">-</span><span class="n">c</span>
<span class="n">setup</span> <span class="n">ts_scheduler</span>
<span class="n">scons</span>
</pre></div>
</div>
<p>Declare SOCS:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">gitdir</span><span class="o">/</span><span class="n">sims_ocs</span>
<span class="n">eups</span> <span class="n">declare</span> <span class="n">sims_ocs</span> <span class="n">git</span> <span class="o">-</span><span class="n">r</span> <span class="o">.</span> <span class="o">-</span><span class="n">c</span>
<span class="n">setup</span> <span class="n">sims_ocs</span>
<span class="n">scons</span>
</pre></div>
</div>
<p><strong>NOTE</strong>: The declaration steps only need to be done once. After that, when returning to the same conda environment, do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="n">stack_install_dir</span><span class="o">/</span><span class="n">loadLSST</span><span class="o">.&lt;</span><span class="n">shell</span><span class="o">&gt;</span>
<span class="n">source</span> <span class="n">activate</span> <span class="n">opsim4</span>
<span class="n">setup</span> <span class="n">ts_scheduler</span>
<span class="n">setup</span> <span class="n">sims_ocs</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="sky-brightness-model-data">
<span id="skymodel-data"></span><h3>Sky Brightness Model Data<a class="headerlink" href="#sky-brightness-model-data" title="Permalink to this headline">¶</a></h3>
<p>In the previous section, the pre-calculated sky brightness model was installed, but it does not come with the data required to run. The required data is ~65 GB in size. It can be installed either along side the sky brightness model code or in a directory of the user’s choosing. To install along side the code, do the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">gitdir</span><span class="o">/</span><span class="n">sims_skybrightness_pre</span><span class="o">/</span><span class="n">data</span>
<span class="o">./</span><span class="n">data_down</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">o</span>
</pre></div>
</div>
<p>To install in a different directory, go to that directory and run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">gitdir</span><span class="o">/</span><span class="n">sims_skybrightness_pre</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">data_down</span><span class="o">.</span><span class="n">sh</span> <span class="o">-</span><span class="n">o</span>
</pre></div>
</div>
<p>While the download is proceeding, the instructions may continue to be followed, but OpSim will not function correctly until the data is done downloading.</p>
</div>
<div class="section" id="database-setup">
<span id="installation-database"></span><h3>Database Setup<a class="headerlink" href="#database-setup" title="Permalink to this headline">¶</a></h3>
<p>SOCS provides a SQLite interface for simulation information storage. A script, <code class="docutils literal"><span class="pre">manage_db</span></code> has been created to help setup the necessary simulation related items. To see the options available:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">manage_db</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>The following assumes a <code class="docutils literal"><span class="pre">$HOME/run_local</span></code> directory with an <code class="docutils literal"><span class="pre">output</span></code> sub-directory already available. To create the SQLite setup, run the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>manage_db --save-dir=$HOME/run_local/output
</pre></div>
</div>
<p>This process creates in <code class="docutils literal"><span class="pre">$HOME/run_local/output</span></code> a <code class="docutils literal"><span class="pre">&lt;hostname&gt;_session.db</span></code> file where <code class="docutils literal"><span class="pre">&lt;hostname&gt;</span></code> is the name of your computer. If you have a DNS provided hostname and would like to have a more “normal” name, add the <code class="docutils literal"><span class="pre">$OPSIM_HOSTNAME</span></code> environmental variable to the session before running the above command. The script also creates a configuration file in <code class="docutils literal"><span class="pre">$HOME/.config</span></code> called <code class="docutils literal"><span class="pre">opsim4</span></code> and it contains the database setup information. This will allow you to not have to provide that information to the main simulation driver script.</p>
<p>If you wish to clear out your database and start over, but begin at the next run number from
where you left off, this task can be accomplished. The <code class="docutils literal"><span class="pre">-s</span></code> flag to the <code class="docutils literal"><span class="pre">manage_db</span></code> will adjust the starting point for the run numbers. You will need the last run number generated and then pass that number incremented by one to the flag. The run number is written into the configuration file for later use when running the simulation.</p>
</div>
</div>
<div class="section" id="docker-installation">
<span id="id2"></span><h2>Docker Installation<a class="headerlink" href="#docker-installation" title="Permalink to this headline">¶</a></h2>
<p>First, install Docker for Mac from <a class="reference external" href="https://www.docker.com/products/docker">Docker</a>. Once installed use the Preferences menu, General tab to set the number of CPUs to 4 and the Memory at least 12 GB. To get the docker image for OpSim4, do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">lsst</span><span class="o">/</span><span class="n">opsim4</span>
</pre></div>
</div>
<p>This will pull the latest version of the image down. Be warned, however, that this image may contain unvetted features and may not work properly. The best thing to do is grab a versioned image. The list of versions, include latest, can be found at the <a class="reference external" href="https://hub.docker.com/r/lsst/opsim4/tags/">OpSimVersions</a> docker page. A versioned image is retrieved by doing the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">pull</span> <span class="n">lsst</span><span class="o">/</span><span class="n">opsim4</span><span class="p">:</span><span class="n">version</span>
</pre></div>
</div>
<p>Where, <code class="docutils literal"><span class="pre">version</span></code> is a tag listed in the referenced page. While the image is retrieved, fetch the provided script for running an OpSim4 container by doing:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">OL</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">lsst</span><span class="o">-</span><span class="n">sims</span><span class="o">/</span><span class="n">sims_ocs</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="n">docker</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">run_opsim4</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>Place the script in a location that is visible from your <code class="docutils literal"><span class="pre">$PATH</span></code>. The script needs to be edited to map local directory on your machine to ones in the container. Anything in the script with <code class="docutils literal"><span class="pre">changeme</span></code> needs to be replaced. To run the container, do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run_opsim4</span> <span class="o">&lt;</span><span class="n">container</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>where <code class="docutils literal"><span class="pre">container</span> <span class="pre">name</span></code> is any name you want to give to the container. The script defaults to <em>latest</em> for the version. If you have a tagged image, use the following method:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">run_opsim4</span> <span class="o">-</span><span class="n">t</span> <span class="o">&lt;</span><span class="n">version</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="n">container</span> <span class="n">name</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The container is designed to start with the LSST stack environment, so to setup OpSim4 do:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">setup</span> <span class="n">ts_scheduler</span>
<span class="n">setup</span> <span class="n">sims_ocs</span>
</pre></div>
</div>
<p>The simulator will not run just yet, however. The sky brightness model data needs to be downloaded. Follow the instructions <a class="reference internal" href="#skymodel-data"><span class="std std-ref">here</span></a> to get things going. While the data is downloading, you can reenter the container to continue the setup process. This action is completed by doing the following:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">exec</span> <span class="o">-</span><span class="n">it</span> <span class="o">&lt;</span><span class="n">container</span> <span class="n">name</span><span class="o">&gt;</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">opsim</span><span class="o">/</span><span class="n">startup</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
<p>You can now follow the instructions in the <a class="reference internal" href="#installation-database"><span class="std std-ref">database installation</span></a> section and the <a class="reference internal" href="usage.html#running-opsim4"><span class="std std-ref">running OpSim4</span></a> part to setup the rest of the simulator. Please ignore all other parts above this section as well as the <code class="docutils literal"><span class="pre">drun</span></code> in front of the OpSim4 execution examples. The container already is setup properly and does not require the use of the <code class="docutils literal"><span class="pre">drun</span></code> wrapper script. Only when the sky brightness data is done downloading will the simulator function properly.</p>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="usage.html" class="btn btn-neutral float-right" title="Usage" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral" title="Simulated Observatory Control System" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015-2017, LSST Systems Engineering.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1.0.11',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>